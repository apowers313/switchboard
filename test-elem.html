<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/bower_components/paper-toast/paper-toast.html">
<dom-module id="test-elem">
    <style>
    </style>
    <template>
        <iron-ajax id="ajaxtest" on-response="getResponse" lastResponse="{{lastResponse}}"></iron-ajax>
        <paper-toast id="loginToast" text="Missing text"></paper-toast>
    </template>
    <script>
    Polymer({
        is: 'test-elem',
        testFunc: function() {
            console.log("Does it work yet?")
        },
        ready: function() {
            console.log("I'm ready");
            this.$.ajaxtest.url = "/auth/local"; // TODO: handle different passport providers
            this.$.ajaxtest.method = "POST";
            this.$.ajaxtest.contentType = "application/json";
            // this.$.ajaxtest.body = JSON.stringify(data);
            this.$.ajaxtest.verbose = true;
            this.$.ajaxtest.response = this.testFunc;
        },
        submit: function(data) {
            console.log("submitting");
            this.$.ajaxtest.body = JSON.stringify(data);
            this.$.ajaxtest.generateRequest();
        },
        getResponse: function(err, res) {
            if (err) {
                console.log("ERROR:", err);
            }
            console.log ("last response:", this.lastResponse);
            var toast = document.querySelector('#loginToast');
            toast.text = this.lastResponse.msg;
            toast.show();
        }
    });
    </script>
</dom-module>
