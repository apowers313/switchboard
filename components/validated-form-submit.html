<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/bower_components/paper-toast/paper-toast.html">
<dom-module id="validated-form-submit">
    <style>
    </style>
    <template>
        <iron-ajax id="ajaxsubmit" on-response="getResponse"></iron-ajax>
        <paper-toast id="responseToast" text="Missing text"></paper-toast>
    </template>
    <script>
    Polymer({
        is: 'validated-form-submit',
        properties: {
            url: {
                type: String,
                value: "NOTSET"
            },
            contentType: {
                type: String,
                value: "application/json"
            },
            method: {
                type: String,
                value: "POST"
            },
        },
        ready: function() {
            this.$.ajaxsubmit.url = this.url;
            this.$.ajaxsubmit.method = this.method;
            this.$.ajaxsubmit.contentType = this.contentType;
            this.$.ajaxsubmit.verbose = true;
            this.$.ajaxsubmit.response = this.testFunc;
        },
        submit: function(data) {
            console.log("submitting");
            this.$.ajaxsubmit.body = JSON.stringify(data);
            this.$.ajaxsubmit.generateRequest();
        },
        getResponse: function(e) {
            console.log ("last response:", e.target.lastResponse);
            var toast = document.querySelector('#responseToast');
            toast.text = (e.target.lastResponse ? e.target.lastResponse.msg : "Can you please try a little harder?");
            toast.show();
        }
    });
    </script>
</dom-module>
